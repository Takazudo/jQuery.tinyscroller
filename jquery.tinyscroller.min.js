/*! jQuery.tinyscroller (https://github.com/Takazudo/jQuery.tinyscroller)
 * lastupdate: 2013-03-29
 * version: 0.4.0
 * author: 'Takazudo' Takeshi Takatsudo <takazudo@gmail.com>
 * License: MIT */
(function(){var t=[].slice,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var s in e)n.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};(function(n,s,o){var i,l,c,a,h,u;return h={},l=n(s),i=n(o),u=Math.round,a=Math.min,c=Math.abs,h.yOf=function(t){var e;for(e=0;t.offsetParent;)e+=t.offsetTop,t=t.offsetParent;return e},h.isHash=function(t){return/^#.+$/.test(t)},h.getWhereTo=function(t){var e;return e=n(t),e.data("scrollto")||e.attr("href")},h.calcY=function(t){var e,r;if("number"===n.type(t))return t;if("string"===n.type(t)){if(!h.isHash(t))return!1;e=i.find(t)}else e=n(t);return e.size()?r=h.yOf(e[0]):null},h.scrollTop=function(){return i.scrollTop()||o.documentElement.scrollTop||o.body.scrollTop||s.pageYOffset||0},h.ua=function(){var t,e,r;return e={},r=navigator.userAgent,t=function(t){var s;return s=!1,n.each(t,function(t,n){var o;return o=RegExp(n,"i"),Boolean(r.match(o))?(e[n]=!0,s=!0):e[n]=!1,!0}),s},t(["iphone","ipod","ipad"]||t(["android"]))&&(e.mobile=!0),e}(),h.Event=function(){function e(){}return e.prototype.bind=function(t,e){var n,r,s,o,i;for(this._callbacks||(this._callbacks={}),n=t.split(" "),o=0,i=n.length;i>o;o++)r=n[o],(s=this._callbacks)[r]||(s[r]=[]),this._callbacks[r].push(e);return this},e.prototype.one=function(t,e){return this._callbacks||(this._callbacks={}),this.bind(t,function(){return this.unbind(t,arguments.callee),e.apply(this,arguments)})},e.prototype.trigger=function(){var e,n,r,s,o,i,l;if(e=arguments.length>=1?t.call(arguments,0):[],this._callbacks||(this._callbacks={}),r=e.shift(),s=null!=(l=this._callbacks)?l[r]:void 0){for(o=0,i=s.length;i>o&&(n=s[o],n.apply(this,e)!==!1);o++);return this}},e.prototype.unbind=function(t,e){var n,r,s,o,i,l;if(this._callbacks||(this._callbacks={}),!t)return this._callbacks={},this;if(s=null!=(l=this._callbacks)?l[t]:void 0,!s)return this;if(!e)return delete this._callbacks[t],this;for(r=o=0,i=s.length;i>o;r=++o)if(n=s[r],n===e){s=s.slice(),s.splice(r,1),this._callbacks[t]=s;break}return this},e}(),h.Scroller=function(t){function o(t){this._stepToNext=e(this._stepToNext,this),t&&this.option(t),this._handleMobile()}var p;return r(o,t),p=["scrollstart","scrollend","scrollcancel"],o.prototype.options={speed:30,maxStep:2e3,slowdownRate:3,changehash:!0,userskip:!0,selector:"a[href^=#]:not(.apply-noscroll)",adjustEndY:!1,dontAdjustEndYIfSelectorIs:null,dontAdjustEndYIfYis:null},o.prototype._handleMobile=function(){return h.ua.mobile?(this.options.userskip=!1,this):this},o.prototype._invokeScroll=function(){var t=this;return this.trigger("scrollstart",this._endY,this._reservedHash),this._scrollDefer.then(function(){return t.options.changehash&&t._reservedHash&&(location.hash=t._reservedHash),t.trigger("scrollend",t._endY,t._reservedHash)},function(){return t.trigger("scrollcancel",t._endY,t._reservedHash)}).always(function(){return t._reservedHash&&(t._reservedHash=null),t._scrollDefer=null}),this._stepToNext(),this},o.prototype._stepToNext=function(){var t,e,n,r,o,p,d,f,_,v,y,Y=this;return f=h.scrollTop(),r=this.options,r.userskip&&this._prevY&&f!==this._prevY?(s.scrollTo(0,this._endY),null!=(v=this._scrollDefer)&&v.resolve(),this._prevY=null,this):(this._endY>f?(t=i.height(),_=l.height(),p=u((t-f-_)/r.slowdownRate),d=u((this._endY-f)/r.slowdownRate),e=a(p,d),o=a(e,r.maxStep),2>o&&(o=2)):o=-a(c(u((this._endY-f)/r.slowdownRate)),r.maxStep),n=f+o,s.scrollTo(0,n),this._prevY=n,this._cancelNext?(this._cancelNext=!1,null!=(y=this._scrollDefer)&&y.reject(),this):(setTimeout(function(){var t;return 1>=c(f-Y._endY)||h.scrollTop()===f?(s.scrollTo(0,Y._endY),Y._prevY=null,null!=(t=Y._scrollDefer)&&t.resolve(),Y):Y._stepToNext()},r.speed),this))},o.prototype.scrollTo=function(t,e){var r,s;return s=!0,this.options.changehash&&(s=!1),this.options.adjustEndY===!1&&(s=!1),(null!=e?e.adjustEndY:void 0)===!1&&(s=!1),h.isHash(t)&&(this._reservedHash=t,this.options.dontAdjustEndYIfSelectorIs&&i.find(t).is(this.options.dontAdjustEndYIfSelectorIs)&&(s=!1)),r=h.calcY(t),r===!1?this:("number"===n.type(this.options.dontAdjustEndYIfYis)&&r===this.options.dontAdjustEndYIfYis&&(s=!1),null!=(null!=e?e.adjustEndY:void 0)?r+=e.adjustEndY:this.options.adjustEndY!==!1&&(r+=this.options.adjustEndY),this._endY=r,this._scrollDefer=n.Deferred(),this._invokeScroll(),this._scrollDefer)},o.prototype.stop=function(){var t=this;return n.Deferred(function(e){return t._scrollDefer?(t._cancelNext=!0,t._scrollDefer.fail(function(){return e.resolve()})):e.resolve()})},o.prototype.option=function(t){var e=this;return t?(this.options=n.extend({},this.options,t),this._handleMobile(),n.each(p,function(t,n){return e.options[n]&&e.bind(n,e.options[n]),!0}),this):this.options},o.prototype.live=function(t){var e;return t=t||this.options.selector,e=this,i.on("click",t,function(t){return t.preventDefault(),e.scrollTo(h.getWhereTo(this))}),this},o}(h.Event),n.fn.tinyscrollable=function(t){var e;return e=new h.Scroller(t),this.each(function(){var t;return t=n(this),t.data("tinyscroller",e),t.data("tinyscrollerattached")?this:(t.on("click",function(t){return t.preventDefault(),e.scrollTo(h.getWhereTo(this))}),t.data("tinyscrollerattached",!0))})},n.TinyscrollerNs=h,n.Tinyscroller=h.Scroller})(jQuery,window,document)}).call(this);