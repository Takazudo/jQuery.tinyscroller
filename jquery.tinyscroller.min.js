/*! jQuery.tinyscroller (https://github.com/Takazudo/jQuery.tinyscroller)
 * lastupdate: 2013-03-29
 * version: 0.3.3
 * author: 'Takazudo' Takeshi Takatsudo <takazudo@gmail.com>
 * License: MIT */
(function(){var t=[].slice,e=function(t,e){return function(){return t.apply(e,arguments)}},r={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var o in e)r.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};(function(r,o,s){var i,l,c,a,h,u;return h={},l=r(o),i=r(s),u=Math.round,a=Math.min,c=Math.abs,h.yOf=function(t){var e;for(e=0;t.offsetParent;)e+=t.offsetTop,t=t.offsetParent;return e},h.isHash=function(t){return/^#.+$/.test(t)},h.getWhereTo=function(t){var e;return e=r(t),e.data("scrollto")||e.attr("href")},h.calcY=function(t){var e,n;if("number"===r.type(t))return t;if("string"===r.type(t)){if(!h.isHash(t))return!1;e=i.find(t)}else e=r(t);return e.size()?n=h.yOf(e[0]):null},h.scrollTop=function(){return i.scrollTop()||s.documentElement.scrollTop||s.body.scrollTop||o.pageYOffset||0},h.ua=function(){var t,e,n;return e={},n=navigator.userAgent,t=function(t){var o;return o=!1,r.each(t,function(t,r){var s;return s=RegExp(r,"i"),Boolean(n.match(s))?(e[r]=!0,o=!0):e[r]=!1,!0}),o},t(["iphone","ipod","ipad"]||t(["android"]))&&(e.mobile=!0),e}(),h.Event=function(){function e(){this._callbacks={}}return e.prototype.bind=function(t,e){var r,n,o,s,i;for(r=t.split(" "),s=0,i=r.length;i>s;s++)n=r[s],(o=this._callbacks)[n]||(o[n]=[]),this._callbacks[n].push(e);return this},e.prototype.one=function(t,e){return this.bind(t,function(){return this.unbind(t,arguments.callee),e.apply(this,arguments)})},e.prototype.trigger=function(){var e,r,n,o,s,i,l;if(e=arguments.length>=1?t.call(arguments,0):[],n=e.shift(),o=null!=(l=this._callbacks)?l[n]:void 0){for(s=0,i=o.length;i>s&&(r=o[s],r.apply(this,e)!==!1);s++);return this}},e.prototype.unbind=function(t,e){var r,n,o,s,i,l;if(!t)return this._callbacks={},this;if(o=null!=(l=this._callbacks)?l[t]:void 0,!o)return this;if(!e)return delete this._callbacks[t],this;for(n=s=0,i=o.length;i>s;n=++s)if(r=o[n],r===e){o=o.slice(),o.splice(n,1),this._callbacks[t]=o;break}return this},e}(),h.Scroller=function(t){function s(t){this._stepToNext=e(this._stepToNext,this),s.__super__.constructor.apply(this,arguments),t&&this.option(t),this._handleMobile()}var p;return n(s,t),p=["scrollstart","scrollend","scrollcancel"],s.prototype.options={speed:30,maxStep:2e3,slowdownRate:3,changehash:!0,userskip:!0,selector:"a[href^=#]:not(.apply-noscroll)"},s.prototype._handleMobile=function(){return h.ua.mobile?(this.options.userskip=!1,this):this},s.prototype._invokeScroll=function(){var t=this;return this.trigger("scrollstart",this._endY,this._reservedHash),this._scrollDefer.then(function(){return t.options.changehash&&t._reservedHash&&(location.hash=t._reservedHash),t.trigger("scrollend",t._endY,t._reservedHash)},function(){return t.trigger("scrollcancel",t._endY,t._reservedHash)}).always(function(){return t._reservedHash&&(t._reservedHash=null),t._scrollDefer=null}),this._stepToNext(),this},s.prototype._stepToNext=function(){var t,e,r,n,s,p,f,_,d,v,y,g=this;return _=h.scrollTop(),n=this.options,n.userskip&&this._prevY&&_!==this._prevY?(o.scrollTo(0,this._endY),null!=(v=this._scrollDefer)&&v.resolve(),this._prevY=null,this):(this._endY>_?(t=i.height(),d=l.height(),p=u((t-_-d)/n.slowdownRate),f=u((this._endY-_)/n.slowdownRate),e=a(p,f),s=a(e,n.maxStep),2>s&&(s=2)):s=-a(c(u((this._endY-_)/n.slowdownRate)),n.maxStep),r=_+s,o.scrollTo(0,r),this._prevY=r,this._cancelNext?(this._cancelNext=!1,null!=(y=this._scrollDefer)&&y.reject(),this):(setTimeout(function(){var t;return 1>=c(_-g._endY)||h.scrollTop()===_?(o.scrollTo(0,g._endY),g._prevY=null,null!=(t=g._scrollDefer)&&t.resolve(),g):g._stepToNext()},n.speed),this))},s.prototype.scrollTo=function(t){var e;return h.isHash(t)&&(this._reservedHash=t),e=h.calcY(t),e===!1?this:(this._endY=e,this._scrollDefer=r.Deferred(),this._invokeScroll(),this._scrollDefer)},s.prototype.stop=function(){var t=this;return r.Deferred(function(e){return t._scrollDefer?(t._cancelNext=!0,t._scrollDefer.fail(function(){return e.resolve()})):e.resolve()})},s.prototype.option=function(t){var e=this;return t?(this.options=r.extend({},this.options,t),this._handleMobile(),r.each(p,function(t,r){return e.options[r]&&e.bind(r,e.options[r]),!0}),this):this.options},s.prototype.live=function(t){var e;return t=t||this.options.selector,e=this,i.on("click",t,function(t){return t.preventDefault(),e.scrollTo(h.getWhereTo(this))}),this},s}(h.Event),r.fn.tinyscrollable=function(t){var e;return e=new h.Scroller(t),this.each(function(){var t;return t=r(this),t.data("tinyscroller",e),t.data("tinyscrollerattached")?this:(t.on("click",function(t){return t.preventDefault(),e.scrollTo(h.getWhereTo(this))}),t.data("tinyscrollerattached",!0))})},r.TinyscrollerNs=h,r.Tinyscroller=h.Scroller})(jQuery,window,document)}).call(this);